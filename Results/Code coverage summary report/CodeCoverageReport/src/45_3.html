<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>D:\Programming\Projects\LlmUnitTestGenerationArtifacts\Qwen3Coder30BUnitTests\Sample3Tests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Linq.Expressions;
using Dataset.Sample3;
using NSubstitute;

namespace Qwen3Coder30BUnitTests
{
    public class NoteServiceTests
    {
        private readonly IUnitOfWork _unitOfWork;
        private readonly IRepository&lt;NoteEntity&gt; _notesRepository;
        private readonly NoteService _service;

        public NoteServiceTests()
        {
            _unitOfWork = Substitute.For&lt;IUnitOfWork&gt;();
            _notesRepository = Substitute.For&lt;IRepository&lt;NoteEntity&gt;&gt;();
            _unitOfWork.GetRepository&lt;NoteEntity&gt;().Returns(_notesRepository);
            _service = new NoteService(_unitOfWork);
        }

        [Fact]
        public async Task GetAllByUserIdAsync_WithValidUserId_ReturnsNotes()
        {
            // Arrange
            var userId = 1;
            var noteEntities = new List&lt;NoteEntity&gt;
            {
                new NoteEntity { Id = 1, Title = &quot;Title1&quot;, Content = &quot;Content1&quot;, CreatedAt = DateTime.UtcNow, ModifiedAt = DateTime.UtcNow, UserId = userId },
                new NoteEntity { Id = 2, Title = &quot;Title2&quot;, Content = &quot;Content2&quot;, CreatedAt = DateTime.UtcNow, ModifiedAt = DateTime.UtcNow, UserId = userId }
            };
            _notesRepository.GetAllAsync(Arg.Any&lt;Expression&lt;Func&lt;NoteEntity, bool&gt;&gt;&gt;()).Returns(noteEntities);

            // Act
            var result = await _service.GetAllByUserIdAsync(userId);

            // Assert
            Assert.Equal(2, result.Count);
            Assert.Equal(&quot;Title1&quot;, result.First().Title);
        }

        [Fact]
        public async Task GetByIdAsync_WithValidId_ReturnsNote()
        {
            // Arrange
            var noteEntity = new NoteEntity { Id = 1, Title = &quot;Title&quot;, Content = &quot;Content&quot;, CreatedAt = DateTime.UtcNow, ModifiedAt = DateTime.UtcNow, UserId = 1 };
            _notesRepository.GetByIdAsync(1).Returns(noteEntity);

            // Act
            var result = await _service.GetByIdAsync(1);

            // Assert
            Assert.Equal(&quot;Title&quot;, result.Title);
            Assert.Equal(&quot;Content&quot;, result.Content);
        }

        [Fact]
        public async Task GetByIdAsync_WithInvalidId_ThrowsNoteNotFoundException()
        {
            // Arrange
            _notesRepository.GetByIdAsync(1).Returns((NoteEntity)null);

            // Act &amp; Assert
            await Assert.ThrowsAsync&lt;NoteNotFoundException&gt;(async () =&gt; await _service.GetByIdAsync(1));
        }

        [Fact]
        public async Task AddAsync_WithValidModel_AddsAndReturnsId()
        {
            // Arrange
            var noteModel = new NoteModel { Title = &quot;Title&quot;, Content = &quot;Content&quot;, UserId = 1 };
            var noteEntity = new NoteEntity { Id = 1, Title = &quot;Title&quot;, Content = &quot;Content&quot;, CreatedAt = DateTime.UtcNow, ModifiedAt = DateTime.UtcNow, UserId = 1 };
            _notesRepository.AddAsync(Arg.Any&lt;NoteEntity&gt;()).Returns(noteEntity);
            _unitOfWork.BeginTransactionAsync().Returns(Substitute.For&lt;IDbContextTransaction&gt;());

            // Act
            var result = await _service.AddAsync(noteModel);

            // Assert
            Assert.Equal(1, result);
        }

        [Fact]
        public async Task AddAsync_WithNullModel_ThrowsNoteNotFoundException()
        {
            // Arrange
            NoteModel noteModel = null;

            // Act &amp; Assert
            await Assert.ThrowsAsync&lt;NoteNotFoundException&gt;(async () =&gt; await _service.AddAsync(noteModel));
        }

        [Fact]
        public async Task AddAsync_WithNullContent_ThrowsNoteNotFoundException()
        {
            // Arrange
            var noteModel = new NoteModel { Title = &quot;Title&quot;, Content = null, UserId = 1 };

            // Act &amp; Assert
            await Assert.ThrowsAsync&lt;NoteNotFoundException&gt;(async () =&gt; await _service.AddAsync(noteModel));
        }

        [Fact]
        public async Task AddAsync_WithInvalidUserId_ThrowsUserNotFoundException()
        {
            // Arrange
            var noteModel = new NoteModel { Title = &quot;Title&quot;, Content = &quot;Content&quot;, UserId = 0 };

            // Act &amp; Assert
            await Assert.ThrowsAsync&lt;UserNotFoundException&gt;(async () =&gt; await _service.AddAsync(noteModel));
        }

        [Fact]
        public async Task UpdateAsync_WithValidModel_UpdatesAndReturnsId()
        {
            // Arrange
            var oldNoteEntity = new NoteEntity { Id = 1, Title = &quot;Old Title&quot;, Content = &quot;Content&quot;, CreatedAt = DateTime.UtcNow, ModifiedAt = DateTime.UtcNow, UserId = 1 };
            var noteModel = new NoteModel { Id = 1, Title = &quot;New Title&quot;, Content = &quot;Content&quot;, UserId = 1 };
            _notesRepository.FirstOrDefaultAsNoTrackingAsync(Arg.Any&lt;Expression&lt;Func&lt;NoteEntity, bool&gt;&gt;&gt;()).Returns(oldNoteEntity);
            _notesRepository.Update(Arg.Any&lt;NoteEntity&gt;()).Returns(x =&gt; x.Arg&lt;NoteEntity&gt;());

            // Act
            var result = await _service.UpdateAsync(noteModel);

            // Assert
            Assert.Equal(1, result);
        }

        [Fact]
        public async Task UpdateAsync_WithNullModel_ThrowsNoteNotFoundException()
        {
            // Arrange
            NoteModel noteModel = null;

            // Act &amp; Assert
            await Assert.ThrowsAsync&lt;NoteNotFoundException&gt;(async () =&gt; await _service.UpdateAsync(noteModel));
        }

        [Fact]
        public async Task UpdateAsync_WithNullContent_ThrowsNoteNotFoundException()
        {
            // Arrange
            var noteModel = new NoteModel { Id = 1, Title = &quot;Title&quot;, Content = null, UserId = 1 };

            // Act &amp; Assert
            await Assert.ThrowsAsync&lt;NoteNotFoundException&gt;(async () =&gt; await _service.UpdateAsync(noteModel));
        }

        [Fact]
        public async Task UpdateAsync_WithNonExistentNote_ThrowsNoteNotFoundException()
        {
            // Arrange
            var noteModel = new NoteModel { Id = 1, Title = &quot;Title&quot;, Content = &quot;Content&quot;, UserId = 1 };
            _notesRepository.FirstOrDefaultAsNoTrackingAsync(Arg.Any&lt;Expression&lt;Func&lt;NoteEntity, bool&gt;&gt;&gt;()).Returns((NoteEntity)null);

            // Act &amp; Assert
            await Assert.ThrowsAsync&lt;NoteNotFoundException&gt;(async () =&gt; await _service.UpdateAsync(noteModel));
        }

        [Fact]
        public async Task UpdateAsync_WithUserMismatch_ThrowsUserNotFoundException()
        {
            // Arrange
            var oldNoteEntity = new NoteEntity { Id = 1, Title = &quot;Title&quot;, Content = &quot;Content&quot;, CreatedAt = DateTime.UtcNow, ModifiedAt = DateTime.UtcNow, UserId = 1 };
            var noteModel = new NoteModel { Id = 1, Title = &quot;Title&quot;, Content = &quot;Content&quot;, UserId = 2 };
            _notesRepository.FirstOrDefaultAsNoTrackingAsync(Arg.Any&lt;Expression&lt;Func&lt;NoteEntity, bool&gt;&gt;&gt;()).Returns(oldNoteEntity);

            // Act &amp; Assert
            await Assert.ThrowsAsync&lt;UserNotFoundException&gt;(async () =&gt; await _service.UpdateAsync(noteModel));
        }

        [Fact]
        public async Task DeleteByIdAsync_WithValidId_DeletesAndReturnsId()
        {
            // Arrange
            var noteEntity = new NoteEntity { Id = 1, Title = &quot;Title&quot;, Content = &quot;Content&quot;, CreatedAt = DateTime.UtcNow, ModifiedAt = DateTime.UtcNow, UserId = 1 };
            _notesRepository.GetByIdAsync(1).Returns(noteEntity);
            _notesRepository.Delete(Arg.Any&lt;NoteEntity&gt;()).Returns(noteEntity);
            _unitOfWork.BeginTransactionAsync().Returns(Substitute.For&lt;IDbContextTransaction&gt;());

            // Act
            var result = await _service.DeleteByIdAsync(1);

            // Assert
            Assert.Equal(1, result);
        }

        [Fact]
        public async Task DeleteByIdAsync_WithInvalidId_ThrowsNoteNotFoundException()
        {
            // Arrange
            _notesRepository.GetByIdAsync(1).Returns((NoteEntity)null);

            // Act &amp; Assert
            await Assert.ThrowsAsync&lt;NoteNotFoundException&gt;(async () =&gt; await _service.DeleteByIdAsync(1));
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[13,9,13,34,1],[14,9,14,10,1],[15,13,15,57,1],[16,13,16,74,1],[17,13,17,79,1],[18,13,18,53,1],[19,9,19,10,1],[23,9,23,10,1],[25,13,25,28,1],[26,13,30,15,1],[31,13,31,111,1],[34,13,34,69,1],[37,13,37,43,1],[38,13,38,58,1],[39,9,39,10,1],[43,9,43,10,1],[45,13,45,165,1],[46,13,46,66,1],[49,13,49,57,1],[52,13,52,49,1],[53,13,53,53,1],[54,9,54,10,1],[58,9,58,10,1],[60,13,60,72,1],[63,13,63,105,1],[64,9,64,10,1],[68,9,68,10,1],[70,13,70,96,1],[71,13,71,165,1],[72,13,72,82,1],[73,13,73,98,1],[76,13,76,61,1],[79,13,79,37,1],[80,9,80,10,1],[84,9,84,10,1],[86,13,86,40,1],[89,13,89,73,1],[89,73,89,107,1],[89,107,89,109,1],[90,9,90,10,1],[94,9,94,10,1],[96,13,96,91,1],[99,13,99,73,1],[99,73,99,107,1],[99,107,99,109,1],[100,9,100,10,1],[104,9,104,10,1],[106,13,106,96,1],[109,13,109,73,1],[109,73,109,107,1],[109,107,109,109,1],[110,9,110,10,1],[114,9,114,10,1],[116,13,116,172,1],[117,13,117,108,1],[118,13,118,132,1],[119,13,119,73,1],[119,73,119,92,1],[119,92,119,94,1],[122,13,122,64,1],[125,13,125,37,1],[126,9,126,10,1],[130,9,130,10,1],[132,13,132,40,1],[135,13,135,73,1],[135,73,135,110,1],[135,110,135,112,1],[136,9,136,10,1],[140,9,140,10,1],[142,13,142,99,1],[145,13,145,73,1],[145,73,145,110,1],[145,110,145,112,1],[146,9,146,10,1],[150,9,150,10,1],[152,13,152,104,1],[153,13,153,135,1],[156,13,156,73,1],[156,73,156,110,1],[156,110,156,112,1],[157,9,157,10,1],[161,9,161,10,1],[163,13,163,168,1],[164,13,164,104,1],[165,13,165,132,1],[168,13,168,73,1],[168,73,168,110,1],[168,110,168,112,1],[169,9,169,10,1],[173,9,173,10,1],[175,13,175,165,1],[176,13,176,66,1],[177,13,177,80,1],[178,13,178,98,1],[181,13,181,60,1],[184,13,184,37,1],[185,9,185,10,1],[189,9,189,10,1],[191,13,191,72,1],[194,13,194,108,1],[195,9,195,10,1]]);
    </script>
  </body>
</html>