<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>D:\Programming\Projects\LlmUnitTestGenerationArtifacts\Glm45AirUnitTests\Sample5Tests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Dataset.Sample5;
using NSubstitute;

namespace Glm45AirUnitTests;

public class FolderServiceTests
{
    private readonly IFolderRepository _folderRepositorySubstitute;
    private readonly FolderService _folderService;

    public FolderServiceTests()
    {
        _folderRepositorySubstitute = Substitute.For&lt;IFolderRepository&gt;();
        _folderService = new FolderService(_folderRepositorySubstitute);
    }

    public class GetFolderAsync : FolderServiceTests
    {
        [Fact]
        public async Task GivenNullPath_WhenCalled_ThenReturnsRootFolderWithSubFolders()
        {
            // Arrange
            var rootFolderEntities = new List&lt;FolderEntity&gt;
            {
                new FolderEntity { Id = 1, Name = &quot;SubFolder1&quot;, ParentId = null },
                new FolderEntity { Id = 2, Name = &quot;SubFolder2&quot;, ParentId = null }
            };
            _folderRepositorySubstitute.GetRootFoldersAsync().Returns(rootFolderEntities);

            // Act
            var result = await _folderService.GetFolderAsync(null);

            // Assert
            Assert.NotNull(result);
            Assert.Equal(0, result.Id);
            Assert.Equal(&quot;Root&quot;, result.Name);
            Assert.Null(result.ParentId);
            Assert.Equal(2, result.SubFolders.Count());
            Assert.Equal(&quot;SubFolder1&quot;, result.SubFolders.First().Name);
            Assert.Equal(&quot;SubFolder2&quot;, result.SubFolders.ElementAt(1).Name);
            _folderRepositorySubstitute.Received(1).GetRootFoldersAsync();
        }

        [Fact]
        public async Task GivenEmptyPath_WhenCalled_ThenReturnsRootFolderWithSubFolders()
        {
            // Arrange
            var rootFolderEntities = new List&lt;FolderEntity&gt;
            {
                new FolderEntity { Id = 1, Name = &quot;SubFolder1&quot;, ParentId = null }
            };
            _folderRepositorySubstitute.GetRootFoldersAsync().Returns(rootFolderEntities);

            // Act
            var result = await _folderService.GetFolderAsync(&quot;&quot;);

            // Assert
            Assert.NotNull(result);
            Assert.Equal(0, result.Id);
            Assert.Equal(&quot;Root&quot;, result.Name);
            Assert.Null(result.ParentId);
            Assert.Single(result.SubFolders);
            Assert.Equal(&quot;SubFolder1&quot;, result.SubFolders.First().Name);
            _folderRepositorySubstitute.Received(1).GetRootFoldersAsync();
        }

        [Fact]
        public async Task GivenSingleLevelPath_WhenFolderExists_ThenReturnsFolder()
        {
            // Arrange
            var folderName = &quot;ExistingFolder&quot;;
            var folderEntity = new FolderEntity { Id = 1, Name = folderName, ParentId = null, SubFolders = new List&lt;FolderEntity&gt;() };
            _folderRepositorySubstitute.GetFolderByNameAsync(folderName).Returns(folderEntity);

            // Act
            var result = await _folderService.GetFolderAsync($&quot;/{folderName}/&quot;);

            // Assert
            Assert.NotNull(result);
            Assert.Equal(folderEntity.Id, result.Id);
            Assert.Equal(folderEntity.Name, result.Name);
            Assert.Equal(folderEntity.ParentId, result.ParentId);
            Assert.Empty(result.SubFolders);
            _folderRepositorySubstitute.Received(1).GetFolderByNameAsync(folderName);
        }

        [Fact]
        public async Task GivenSingleLevelPath_WhenFolderDoesNotExist_ThenThrowsFolderNotFoundException()
        {
            // Arrange
            var folderName = &quot;NonExistingFolder&quot;;
            _folderRepositorySubstitute.GetFolderByNameAsync(folderName).Returns((FolderEntity?)null);

            // Act &amp; Assert
            var exception = await Assert.ThrowsAsync&lt;FolderNotFoundException&gt;(() =&gt; _folderService.GetFolderAsync(folderName));
            Assert.Contains($&quot;Folder `{folderName}` does not exist.&quot;, exception.Message);
            _folderRepositorySubstitute.Received(1).GetFolderByNameAsync(folderName);
        }

        [Fact]
        public async Task GivenMultiLevelPath_WhenAllFoldersExist_ThenReturnsFolder()
        {
            // Arrange
            var path = &quot;Parent/Child&quot;;
            var parentFolderName = &quot;Parent&quot;;
            var childFolderName = &quot;Child&quot;;

            var parentFolderEntity = new FolderEntity { Id = 1, Name = parentFolderName, ParentId = null, SubFolders = new List&lt;FolderEntity&gt; { new() { Name = childFolderName } } };
            var childFolderEntity = new FolderEntity { Id = 2, Name = childFolderName, ParentId = 1, SubFolders = new List&lt;FolderEntity&gt;() };

            _folderRepositorySubstitute.GetFolderByNameAsync(parentFolderName).Returns(parentFolderEntity);
            _folderRepositorySubstitute.GetFolderByNameAsync(childFolderName, 1).Returns(childFolderEntity);

            // Act
            var result = await _folderService.GetFolderAsync(path);

            // Assert
            Assert.NotNull(result);
            Assert.Equal(childFolderEntity.Id, result.Id);
            Assert.Equal(childFolderEntity.Name, result.Name);
            Assert.Equal(childFolderEntity.ParentId, result.ParentId);
            Assert.Empty(result.SubFolders);
            _folderRepositorySubstitute.Received(1).GetFolderByNameAsync(parentFolderName);
            _folderRepositorySubstitute.Received(1).GetFolderByNameAsync(childFolderName, 1);
        }

        [Fact]
        public async Task GivenMultiLevelPath_WhenIntermediateFolderDoesNotExist_ThenThrowsFolderNotFoundException()
        {
            // Arrange
            var path = &quot;Parent/Child&quot;;
            var parentFolderName = &quot;Parent&quot;;
            var childFolderName = &quot;Child&quot;;

            var parentFolderEntity = new FolderEntity { Id = 1, Name = parentFolderName, ParentId = null, SubFolders = new List&lt;FolderEntity&gt;() };

            _folderRepositorySubstitute.GetFolderByNameAsync(parentFolderName).Returns(parentFolderEntity);
            _folderRepositorySubstitute.GetFolderByNameAsync(childFolderName, 1).Returns((FolderEntity?)null);

            // Act &amp; Assert
            var exception = await Assert.ThrowsAsync&lt;FolderNotFoundException&gt;(() =&gt; _folderService.GetFolderAsync(path));
            Assert.Contains($&quot;Folder `{childFolderName}` does not exist.&quot;, exception.Message);
            _folderRepositorySubstitute.Received(1).GetFolderByNameAsync(parentFolderName);
            _folderRepositorySubstitute.Received(1).GetFolderByNameAsync(childFolderName, 1);
        }

        [Fact]
        public async Task GivenMultiLevelPath_WhenFirstFolderDoesNotExist_ThenThrowsFolderNotFoundException()
        {
            // Arrange
            var path = &quot;NonExisting/Child&quot;;
            var folderName = &quot;NonExisting&quot;;

            _folderRepositorySubstitute.GetFolderByNameAsync(folderName).Returns((FolderEntity?)null);

            // Act &amp; Assert
            var exception = await Assert.ThrowsAsync&lt;FolderNotFoundException&gt;(() =&gt; _folderService.GetFolderAsync(path));
            Assert.Contains($&quot;Folder `{folderName}` does not exist.&quot;, exception.Message);
            _folderRepositorySubstitute.Received(1).GetFolderByNameAsync(folderName);
        }

        [Fact]
        public async Task GivenPathWithLeadingAndTrailingSlashes_WhenCalled_ThenHandlesCorrectly()
        {
            // Arrange
            var folderName = &quot;ExistingFolder&quot;;
            var folderEntity = new FolderEntity { Id = 1, Name = folderName, ParentId = null, SubFolders = new List&lt;FolderEntity&gt;() };
            _folderRepositorySubstitute.GetFolderByNameAsync(folderName).Returns(folderEntity);

            // Act
            var result = await _folderService.GetFolderAsync($&quot;///{folderName}///&quot;);

            // Assert
            Assert.NotNull(result);
            Assert.Equal(folderEntity.Id, result.Id);
            Assert.Equal(folderEntity.Name, result.Name);
            _folderRepositorySubstitute.Received(1).GetFolderByNameAsync(folderName);
        }
    }

    public class GetRootFoldersAsync : FolderServiceTests
    {
        [Fact]
        public async Task WhenCalled_ThenReturnsRootFolders()
        {
            // Arrange
            var rootFolderEntities = new List&lt;FolderEntity&gt;
            {
                new FolderEntity { Id = 1, Name = &quot;RootFolder1&quot;, ParentId = null },
                new FolderEntity { Id = 2, Name = &quot;RootFolder2&quot;, ParentId = null }
            };
            _folderRepositorySubstitute.GetRootFoldersAsync().Returns(rootFolderEntities);

            // Act
            var result = await _folderService.GetRootFoldersAsync();

            // Assert
            Assert.NotNull(result);
            var resultList = new List&lt;FolderDTO&gt;(result);
            Assert.Equal(2, resultList.Count);
            Assert.Equal(&quot;RootFolder1&quot;, resultList[0].Name);
            Assert.Equal(&quot;RootFolder2&quot;, resultList[1].Name);
            Assert.Null(resultList[0].SubFolders);
            Assert.Null(resultList[1].SubFolders);
            _folderRepositorySubstitute.Received(1).GetRootFoldersAsync();
        }
    }

    public class AddFolderAsync : FolderServiceTests
    {
        [Fact]
        public async Task GivenValidFolderDto_WhenCalled_ThenAddsFolderAndReturnsId()
        {
            // Arrange
            var folderDto = new FolderDTO { Name = &quot;NewFolder&quot;, ParentId = 1 };
            var expectedId = 5;
            _folderRepositorySubstitute.AddFolderAsync(Arg.Any&lt;FolderEntity&gt;()).Returns(expectedId);
            _folderRepositorySubstitute.GetFolderByNameAsync(folderDto.Name, folderDto.ParentId).Returns((FolderEntity?)null);

            // Act
            var result = await _folderService.AddFolderAsync(folderDto);

            // Assert
            Assert.Equal(expectedId, result);
            await _folderRepositorySubstitute.Received(1).AddFolderAsync(Arg.Is&lt;FolderEntity&gt;(
                f =&gt; f.Name == folderDto.Name &amp;&amp; f.ParentId == folderDto.ParentId));
            _folderRepositorySubstitute.Received(1).GetFolderByNameAsync(folderDto.Name, folderDto.ParentId);
        }

        [Fact]
        public async Task GivenNullFolderDto_WhenCalled_ThenThrowsArgumentNullException()
        {
            // Arrange
            FolderDTO folderDto = null;

            // Act &amp; Assert
            var exception = await Assert.ThrowsAsync&lt;ArgumentNullException&gt;(() =&gt; _folderService.AddFolderAsync(folderDto));
            Assert.Equal(nameof(folderDto), exception.ParamName);
        }

        [Theory]
        [InlineData(&quot;&quot;)]
        [InlineData(null)]
        [InlineData(&quot;Name/With/Slash&quot;)]
        public async Task GivenInvalidName_WhenCalled_ThenThrowsArgumentException(string invalidName)
        {
            // Arrange
            var folderDto = new FolderDTO { Name = invalidName, ParentId = 1 };

            // Act &amp; Assert
            var exception = await Assert.ThrowsAsync&lt;ArgumentException&gt;(() =&gt; _folderService.AddFolderAsync(folderDto));
            Assert.Equal(nameof(folderDto.Name), exception.ParamName);
        }

        [Theory]
        [InlineData(256)]
        [InlineData(300)]
        public async Task GivenVeryLongName_WhenCalled_ThenThrowsArgumentException(int nameLength)
        {
            var invalidName = new string(&#39;a&#39;, nameLength);

            // Arrange
            var folderDto = new FolderDTO { Name = invalidName, ParentId = 1 };

            // Act &amp; Assert
            var exception = await Assert.ThrowsAsync&lt;ArgumentException&gt;(() =&gt; _folderService.AddFolderAsync(folderDto));
            Assert.Equal(nameof(folderDto.Name), exception.ParamName);
        }

        [Fact]
        public async Task GivenInvalidParentId_WhenCalled_ThenThrowsArgumentException()
        {
            // Arrange
            var folderDto = new FolderDTO { Name = &quot;ValidName&quot;, ParentId = 0 };

            // Act &amp; Assert
            var exception = await Assert.ThrowsAsync&lt;ArgumentException&gt;(() =&gt; _folderService.AddFolderAsync(folderDto));
            Assert.Equal(nameof(folderDto.ParentId), exception.ParamName);
        }

        [Fact]
        public async Task GivenFolderWithSameNameAndParentIdAlreadyExists_WhenCalled_ThenThrowsArgumentException()
        {
            // Arrange
            var folderDto = new FolderDTO { Name = &quot;ExistingFolder&quot;, ParentId = 1 };
            var existingFolder = new FolderEntity { Id = 2, Name = &quot;ExistingFolder&quot;, ParentId = 1 };
            _folderRepositorySubstitute.GetFolderByNameAsync(folderDto.Name, folderDto.ParentId).Returns(existingFolder);

            // Act &amp; Assert
            var exception = await Assert.ThrowsAsync&lt;ArgumentException&gt;(() =&gt; _folderService.AddFolderAsync(folderDto));
            Assert.Equal(nameof(folderDto.Name), exception.ParamName);
            _folderRepositorySubstitute.Received(1).GetFolderByNameAsync(folderDto.Name, folderDto.ParentId);
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[11,5,11,32,1],[12,5,12,6,1],[13,9,13,75,1],[14,9,14,73,1],[15,5,15,6,1],[21,9,21,10,1],[23,13,27,15,1],[28,13,28,91,1],[31,13,31,68,1],[34,13,34,36,1],[35,13,35,40,1],[36,13,36,47,1],[37,13,37,42,1],[38,13,38,56,1],[39,13,39,72,1],[40,13,40,77,1],[41,13,41,75,1],[42,9,42,10,1],[46,9,46,10,1],[48,13,51,15,1],[52,13,52,91,1],[55,13,55,66,1],[58,13,58,36,0],[59,13,59,40,0],[60,13,60,47,0],[61,13,61,42,0],[62,13,62,46,0],[63,13,63,72,0],[64,13,64,75,0],[65,9,65,10,0],[69,9,69,10,1],[71,13,71,47,1],[72,13,72,135,1],[73,13,73,96,1],[76,13,76,81,1],[79,13,79,36,1],[80,13,80,54,1],[81,13,81,58,1],[82,13,82,66,1],[83,13,83,45,1],[84,13,84,86,1],[85,9,85,10,1],[89,9,89,10,1],[91,13,91,50,1],[92,13,92,103,1],[95,13,95,85,1],[95,85,95,126,1],[95,126,95,128,1],[96,13,96,90,1],[97,13,97,86,1],[98,9,98,10,1],[102,9,102,10,1],[104,13,104,39,1],[105,13,105,45,1],[106,13,106,43,1],[108,13,108,182,1],[109,13,109,142,1],[111,13,111,108,1],[112,13,112,109,1],[115,13,115,68,1],[118,13,118,36,1],[119,13,119,59,1],[120,13,120,63,1],[121,13,121,71,1],[122,13,122,45,1],[123,13,123,92,1],[124,13,124,94,1],[125,9,125,10,1],[129,9,129,10,1],[131,13,131,39,1],[132,13,132,45,1],[133,13,133,43,1],[135,13,135,147,1],[137,13,137,108,1],[138,13,138,111,1],[141,13,141,85,1],[141,85,141,120,1],[141,120,141,122,1],[142,13,142,95,1],[143,13,143,92,1],[144,13,144,94,1],[145,9,145,10,0],[149,9,149,10,1],[151,13,151,44,1],[152,13,152,44,1],[154,13,154,103,1],[157,13,157,85,1],[157,85,157,120,1],[157,120,157,122,1],[158,13,158,90,1],[159,13,159,86,1],[160,9,160,10,1],[164,9,164,10,1],[166,13,166,47,1],[167,13,167,135,1],[168,13,168,96,1],[171,13,171,85,1],[174,13,174,36,1],[175,13,175,54,1],[176,13,176,58,1],[177,13,177,86,1],[178,9,178,10,1],[185,9,185,10,1],[187,13,191,15,1],[192,13,192,91,1],[195,13,195,69,1],[198,13,198,36,1],[199,13,199,58,1],[200,13,200,47,1],[201,13,201,61,1],[202,13,202,61,1],[203,13,203,51,1],[204,13,204,51,1],[205,13,205,75,1],[206,9,206,10,1],[213,9,213,10,1],[215,13,215,80,1],[216,13,216,32,1],[217,13,217,101,1],[218,13,218,127,1],[221,13,221,73,1],[224,13,224,46,1],[225,13,226,85,1],[227,13,227,110,1],[228,9,228,10,1],[232,9,232,10,1],[234,13,234,40,1],[237,13,237,83,1],[237,83,237,123,1],[237,123,237,125,1],[238,13,238,66,1],[239,9,239,10,1],[246,9,246,10,1],[248,13,248,80,1],[251,13,251,79,1],[251,79,251,119,1],[251,119,251,121,1],[252,13,252,71,1],[253,9,253,10,0],[259,9,259,10,1],[260,13,260,59,1],[263,13,263,80,1],[266,13,266,79,1],[266,79,266,119,1],[266,119,266,121,1],[267,13,267,71,1],[268,9,268,10,0],[272,9,272,10,1],[274,13,274,80,1],[277,13,277,79,1],[277,79,277,119,1],[277,119,277,121,1],[278,13,278,75,1],[279,9,279,10,0],[283,9,283,10,1],[285,13,285,85,1],[286,13,286,101,1],[287,13,287,122,1],[290,13,290,79,1],[290,79,290,119,1],[290,119,290,121,1],[291,13,291,71,1],[292,13,292,110,0],[293,9,293,10,0]]);
    </script>
  </body>
</html>