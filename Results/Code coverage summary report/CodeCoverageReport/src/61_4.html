<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>D:\Programming\Projects\LlmUnitTestGenerationArtifacts\Gemini3ProUnitTests\Sample2Tests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Dataset.Sample2;
using NSubstitute;

namespace Gemini3ProUnitTests;

public class EmployeeServiceTests
{
    private readonly IEmployeeRepository _employeeRepository;
    private readonly EmployeeService _sut;

    public EmployeeServiceTests()
    {
        _employeeRepository = Substitute.For&lt;IEmployeeRepository&gt;();
        _sut = new EmployeeService(_employeeRepository);
    }

    [Fact]
    public async Task GetAsync_WhenEmployeeExists_ReturnsMappedModel()
    {
        // Arrange
        var entity = new EmployeeEntity
        {
            Id = 1,
            FirstName = &quot;John&quot;,
            LastName = &quot;Doe&quot;,
            Department = &quot;IT&quot;,
            Position = &quot;Dev&quot;
        };
        _employeeRepository.GetAsync(1).Returns(entity);

        // Act
        var result = await _sut.GetAsync(1);

        // Assert
        Assert.NotNull(result);
        Assert.Equal(entity.Id, result.Id);
        Assert.Equal(entity.FirstName, result.FirstName);
        Assert.Equal(entity.LastName, result.LastName);
        await _employeeRepository.Received(1).GetAsync(1);
    }

    [Fact]
    public async Task ListAsync_WhenCalled_ReturnsMappedCollection()
    {
        // Arrange
        var entities = new List&lt;EmployeeEntity&gt;
        {
            new() { Id = 1, FirstName = &quot;A&quot;, LastName = &quot;B&quot;, Department = &quot;D&quot;, Position = &quot;P&quot; },
            new() { Id = 2, FirstName = &quot;C&quot;, LastName = &quot;D&quot;, Department = &quot;D&quot;, Position = &quot;P&quot; }
        };
        _employeeRepository.ListAsync().Returns(entities);

        // Act
        var result = await _sut.ListAsync();

        // Assert
        Assert.Equal(2, result.Count);
        Assert.Equal(1, result.First().Id);
        await _employeeRepository.Received(1).ListAsync();
    }

    [Fact]
    public async Task ListFilteredAsync_WhenFiltersAreEmptyOrZero_CallsListAsync()
    {
        // Arrange
        var entities = new List&lt;EmployeeEntity&gt;();
        _employeeRepository.ListAsync().Returns(entities);

        // Act
        await _sut.ListFilteredAsync(null!, &quot;&quot;, null!, 0, 0, 0, 0);

        // Assert
        await _employeeRepository.Received(1).ListAsync();
        await _employeeRepository.DidNotReceiveWithAnyArgs().ListFilteredAsync(default, default, default, default, default, default, default);
    }

    [Fact]
    public async Task ListFilteredAsync_WhenFiltersAreProvided_CallsListFilteredAsync()
    {
        // Arrange
        var entities = new List&lt;EmployeeEntity&gt;();
        string name = &quot;John&quot;;
        decimal minSalary = 1000;

        _employeeRepository.ListFilteredAsync(
            Arg.Any&lt;string&gt;(), Arg.Any&lt;string&gt;(), Arg.Any&lt;string&gt;(),
            Arg.Any&lt;decimal&gt;(), Arg.Any&lt;decimal&gt;(),
            Arg.Any&lt;int&gt;(), Arg.Any&lt;int&gt;())
            .Returns(entities);

        // Act
        await _sut.ListFilteredAsync(name, null!, null!, minSalary, 0, 0, 0);

        // Assert
        await _employeeRepository.DidNotReceive().ListAsync();
        await _employeeRepository.Received(1).ListFilteredAsync(name, null!, null!, minSalary, 0, 0, 0);
    }

    [Fact]
    public async Task AddAsync_WithValidModel_TrimsStringsAddsPhonePrefixAndCallsRepo()
    {
        // Arrange
        var model = CreateValidModel();
        model.FirstName = &quot; John &quot;; // Should trim
        model.Phone = &quot;1234567890&quot;; // Should add +

        _employeeRepository.AddAsync(Arg.Any&lt;EmployeeEntity&gt;()).Returns(10);

        // Act
        var result = await _sut.AddAsync(model);

        // Assert
        Assert.Equal(10, result);
        Assert.Equal(&quot;John&quot;, model.FirstName); // Side effect verification
        Assert.Equal(&quot;+1234567890&quot;, model.Phone);

        await _employeeRepository.Received(1).AddAsync(Arg.Is&lt;EmployeeEntity&gt;(x =&gt;
            x.FirstName == &quot;John&quot; &amp;&amp;
            x.Phone == &quot;+1234567890&quot; &amp;&amp;
            x.DepartmentId == model.DepartmentId
        ));
    }

    [Fact]
    public async Task AddAsync_WithRunOfPaperValidInputs_Succeeds()
    {
        // Arrange
        var model = CreateValidModel();
        // Edge cases for validation regex/pattern
        model.FirstName = &quot;Jean-Luc&quot;; // Hyphen allowed
        model.LastName = &quot;O Connor&quot;; // Space allowed

        _employeeRepository.AddAsync(Arg.Any&lt;EmployeeEntity&gt;()).Returns(1);

        // Act
        var result = await _sut.AddAsync(model);

        // Assert
        Assert.Equal(1, result);
    }

    [Fact]
    public async Task AddAsync_WithNullModel_ThrowsArgumentNullException()
    {
        // Act &amp; Assert
        await Assert.ThrowsAsync&lt;ArgumentNullException&gt;(() =&gt; _sut.AddAsync(null!));
    }

    [Theory]
    [InlineData(&quot;&quot;)]
    [InlineData(&quot; &quot;)]
    [InlineData(&quot;John1&quot;)] // Invalid regex (digits)
    [InlineData(&quot;John!&quot;)] // Invalid regex (special chars)
    public async Task AddAsync_InvalidFirstName_ThrowsArgumentException(string invalidName)
    {
        // Arrange
        var model = CreateValidModel();
        model.FirstName = invalidName;

        // Act &amp; Assert
        await Assert.ThrowsAsync&lt;ArgumentException&gt;(() =&gt; _sut.AddAsync(model));
    }

    [Fact]
    public async Task AddAsync_FirstNameTooLong_ThrowsArgumentException()
    {
        // Arrange
        var model = CreateValidModel();
        model.FirstName = new string(&#39;a&#39;, 51);

        // Act &amp; Assert
        await Assert.ThrowsAsync&lt;ArgumentException&gt;(() =&gt; _sut.AddAsync(model));
    }

    [Theory]
    [InlineData(&quot;&quot;)]
    [InlineData(&quot;Doe1&quot;)]
    public async Task AddAsync_InvalidLastName_ThrowsArgumentException(string invalidName)
    {
        // Arrange
        var model = CreateValidModel();
        model.LastName = invalidName;

        // Act &amp; Assert
        await Assert.ThrowsAsync&lt;ArgumentException&gt;(() =&gt; _sut.AddAsync(model));
    }

    [Theory]
    [InlineData(&quot;&quot;)]
    [InlineData(&quot;M.&quot;)] // Dot not allowed by regex
    public async Task AddAsync_InvalidMiddleName_ThrowsArgumentException(string invalidName)
    {
        // Arrange
        var model = CreateValidModel();
        model.MiddleName = invalidName;

        // Act &amp; Assert
        await Assert.ThrowsAsync&lt;ArgumentException&gt;(() =&gt; _sut.AddAsync(model));
    }

    [Theory]
    [InlineData(1950, 1, 1)] // Lower bound strict (&lt;= check)
    [InlineData(1949, 12, 31)]
    [InlineData(2010, 1, 1)] // Upper bound strict (&gt;= check)
    [InlineData(2011, 1, 1)]
    public async Task AddAsync_InvalidBirthDate_ThrowsArgumentException(int year, int month, int day)
    {
        // Arrange
        var model = CreateValidModel();
        model.BirthDate = new DateTime(year, month, day);

        // Act &amp; Assert
        await Assert.ThrowsAsync&lt;ArgumentException&gt;(() =&gt; _sut.AddAsync(model));
    }

    [Fact]
    public async Task AddAsync_InvalidCountry_ThrowsArgumentException()
    {
        // Arrange
        var model = CreateValidModel();
        model.Country = &quot;US1&quot;; // Regex failure

        // Act &amp; Assert
        await Assert.ThrowsAsync&lt;ArgumentException&gt;(() =&gt; _sut.AddAsync(model));
    }

    [Fact]
    public async Task AddAsync_CityTooLong_ThrowsArgumentException()
    {
        // Arrange
        var model = CreateValidModel();
        model.City = new string(&#39;a&#39;, 51);

        // Act &amp; Assert
        await Assert.ThrowsAsync&lt;ArgumentException&gt;(() =&gt; _sut.AddAsync(model));
    }

    [Fact]
    public async Task AddAsync_AddressTooLong_ThrowsArgumentException()
    {
        // Arrange
        var model = CreateValidModel();
        model.Address = new string(&#39;a&#39;, 51);

        // Act &amp; Assert
        // Note: The source code throws ArgumentException with param name &quot;City&quot; for Address validation.
        // We just verify the type.
        await Assert.ThrowsAsync&lt;ArgumentException&gt;(() =&gt; _sut.AddAsync(model));
    }

    [Theory]
    [InlineData(&quot;+123&quot;)] // Too short
    [InlineData(&quot;+1234567890123&quot;)] // Too long (&gt;12 digits + sign)
    [InlineData(&quot;abc&quot;)] // Invalid chars
    public async Task AddAsync_InvalidPhone_ThrowsArgumentException(string invalidPhone)
    {
        // Arrange
        var model = CreateValidModel();
        model.Phone = invalidPhone;

        // Act &amp; Assert
        await Assert.ThrowsAsync&lt;ArgumentException&gt;(() =&gt; _sut.AddAsync(model));
    }

    [Fact]
    public async Task AddAsync_HireDateBeforeBirth_ThrowsArgumentException()
    {
        // Arrange
        var model = CreateValidModel();
        model.BirthDate = new DateTime(1990, 1, 1);
        model.HireDate = new DateTime(1989, 12, 31);

        // Act &amp; Assert
        await Assert.ThrowsAsync&lt;ArgumentException&gt;(() =&gt; _sut.AddAsync(model));
    }

    [Fact]
    public async Task AddAsync_HireDateBefore1960_ThrowsArgumentException()
    {
        // Arrange
        var model = CreateValidModel();
        model.BirthDate = new DateTime(1955, 1, 1);
        model.HireDate = new DateTime(1959, 12, 31); // &lt;= 1960 logic check

        // Act &amp; Assert
        await Assert.ThrowsAsync&lt;ArgumentException&gt;(() =&gt; _sut.AddAsync(model));
    }

    [Fact]
    public async Task AddAsync_HireDateInFuture_ThrowsArgumentException()
    {
        // Arrange
        var model = CreateValidModel();
        model.HireDate = DateTime.Now.AddDays(1); // Future

        // Act &amp; Assert
        await Assert.ThrowsAsync&lt;ArgumentException&gt;(() =&gt; _sut.AddAsync(model));
    }

    [Theory]
    [InlineData(0)]
    [InlineData(-100)]
    public async Task AddAsync_InvalidSalary_ThrowsArgumentException(decimal salary)
    {
        // Arrange
        var model = CreateValidModel();
        model.Salary = salary;

        // Act &amp; Assert
        await Assert.ThrowsAsync&lt;ArgumentException&gt;(() =&gt; _sut.AddAsync(model));
    }

    [Theory]
    [InlineData(0)]
    [InlineData(-1)]
    public async Task AddAsync_InvalidDepartmentId_ThrowsArgumentException(int depId)
    {
        // Arrange
        var model = CreateValidModel();
        model.DepartmentId = depId;

        // Act &amp; Assert
        await Assert.ThrowsAsync&lt;ArgumentException&gt;(() =&gt; _sut.AddAsync(model));
    }

    [Theory]
    [InlineData(0)]
    [InlineData(-1)]
    public async Task AddAsync_InvalidPositionId_ThrowsArgumentException(int posId)
    {
        // Arrange
        var model = CreateValidModel();
        model.PositionId = posId;

        // Act &amp; Assert
        await Assert.ThrowsAsync&lt;ArgumentException&gt;(() =&gt; _sut.AddAsync(model));
    }

    [Fact]
    public async Task UpdateAsync_WithValidModelAndId_CallsRepo()
    {
        // Arrange
        var model = CreateValidModel();
        model.Id = 5;
        _employeeRepository.UpdateAsync(Arg.Any&lt;EmployeeEntity&gt;()).Returns(1);

        // Act
        var result = await _sut.UpdateAsync(model);

        // Assert
        Assert.Equal(1, result);
        await _employeeRepository.Received(1).UpdateAsync(Arg.Is&lt;EmployeeEntity&gt;(e =&gt; e.Id == 5));
    }

    [Theory]
    [InlineData(0)]
    [InlineData(-1)]
    public async Task UpdateAsync_InvalidId_ThrowsArgumentException(int id)
    {
        // Arrange
        var model = CreateValidModel();
        model.Id = id;

        // Act &amp; Assert
        await Assert.ThrowsAsync&lt;ArgumentException&gt;(() =&gt; _sut.UpdateAsync(model));
    }

    [Fact]
    public async Task DeleteAsync_WhenCalled_ReturnsRepoResult()
    {
        // Arrange
        _employeeRepository.DeleteAsync(10).Returns(1);

        // Act
        var result = await _sut.DeleteAsync(10);

        // Assert
        Assert.Equal(1, result);
        await _employeeRepository.Received(1).DeleteAsync(10);
    }

    private static EmployeeModel CreateValidModel()
    {
        return new EmployeeModel
        {
            FirstName = &quot;John&quot;,
            LastName = &quot;Doe&quot;,
            MiddleName = &quot;Quincy&quot;,
            BirthDate = new DateTime(1980, 1, 1),
            Country = &quot;USA&quot;,
            City = &quot;New York&quot;,
            Address = &quot;123 Wall St&quot;,
            Phone = &quot;+15555555555&quot;,
            HireDate = DateTime.Now.Date, // Use Today to avoid future check failure
            Salary = 50000m,
            DepartmentId = 1,
            Department = &quot;IT&quot;,
            PositionId = 1,
            Position = &quot;Developer&quot;
        };
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[11,5,11,34,1],[12,5,12,6,1],[13,9,13,69,1],[14,9,14,57,1],[15,5,15,6,1],[19,5,19,6,1],[21,9,28,11,1],[29,9,29,57,1],[32,9,32,45,1],[35,9,35,32,1],[36,9,36,44,1],[37,9,37,58,1],[38,9,38,56,1],[39,9,39,59,1],[40,5,40,6,1],[44,5,44,6,1],[46,9,50,11,1],[51,9,51,59,1],[54,9,54,45,1],[57,9,57,39,1],[58,9,58,44,1],[59,9,59,59,1],[60,5,60,6,1],[64,5,64,6,1],[66,9,66,51,1],[67,9,67,59,1],[70,9,70,68,1],[73,9,73,59,1],[74,9,74,143,1],[75,5,75,6,1],[79,5,79,6,1],[81,9,81,51,1],[82,9,82,30,1],[83,9,83,34,1],[85,9,89,32,1],[92,9,92,78,1],[95,9,95,63,1],[96,9,96,105,1],[97,5,97,6,1],[101,5,101,6,1],[103,9,103,40,1],[104,9,104,36,1],[105,9,105,36,1],[107,9,107,77,1],[110,9,110,49,1],[113,9,113,34,1],[114,9,114,47,1],[115,9,115,50,1],[117,9,121,12,1],[122,5,122,6,1],[126,5,126,6,1],[128,9,128,40,1],[130,9,130,38,1],[131,9,131,37,1],[133,9,133,76,1],[136,9,136,49,1],[139,9,139,33,1],[140,5,140,6,1],[144,5,144,6,1],[146,9,146,85,1],[147,5,147,6,1],[155,5,155,6,1],[157,9,157,40,1],[158,9,158,39,1],[161,9,161,59,1],[161,59,161,79,1],[161,79,161,81,1],[162,5,162,6,1],[166,5,166,6,1],[168,9,168,40,1],[169,9,169,47,1],[172,9,172,59,1],[172,59,172,79,1],[172,79,172,81,1],[173,5,173,6,1],[179,5,179,6,1],[181,9,181,40,1],[182,9,182,38,1],[185,9,185,59,1],[185,59,185,79,1],[185,79,185,81,1],[186,5,186,6,1],[192,5,192,6,1],[194,9,194,40,1],[195,9,195,40,1],[198,9,198,59,1],[198,59,198,79,1],[198,79,198,81,1],[199,5,199,6,1],[207,5,207,6,1],[209,9,209,40,1],[210,9,210,58,1],[213,9,213,59,1],[213,59,213,79,1],[213,79,213,81,1],[214,5,214,6,1],[218,5,218,6,1],[220,9,220,40,1],[221,9,221,31,1],[224,9,224,59,1],[224,59,224,79,1],[224,79,224,81,1],[225,5,225,6,1],[229,5,229,6,1],[231,9,231,40,1],[232,9,232,42,1],[235,9,235,59,1],[235,59,235,79,1],[235,79,235,81,1],[236,5,236,6,1],[240,5,240,6,1],[242,9,242,40,1],[243,9,243,45,1],[248,9,248,59,1],[248,59,248,79,1],[248,79,248,81,1],[249,5,249,6,1],[256,5,256,6,1],[258,9,258,40,1],[259,9,259,36,1],[262,9,262,59,1],[262,59,262,79,1],[262,79,262,81,1],[263,5,263,6,1],[267,5,267,6,1],[269,9,269,40,1],[270,9,270,52,1],[271,9,271,53,1],[274,9,274,59,1],[274,59,274,79,1],[274,79,274,81,1],[275,5,275,6,1],[279,5,279,6,1],[281,9,281,40,1],[282,9,282,52,1],[283,9,283,53,1],[286,9,286,59,1],[286,59,286,79,1],[286,79,286,81,1],[287,5,287,6,1],[291,5,291,6,1],[293,9,293,40,1],[294,9,294,50,1],[297,9,297,59,1],[297,59,297,79,1],[297,79,297,81,1],[298,5,298,6,1],[304,5,304,6,1],[306,9,306,40,1],[307,9,307,31,1],[310,9,310,59,1],[310,59,310,79,1],[310,79,310,81,1],[311,5,311,6,1],[317,5,317,6,1],[319,9,319,40,1],[320,9,320,36,1],[323,9,323,59,1],[323,59,323,79,1],[323,79,323,81,1],[324,5,324,6,1],[330,5,330,6,1],[332,9,332,40,1],[333,9,333,34,1],[336,9,336,59,1],[336,59,336,79,1],[336,79,336,81,1],[337,5,337,6,1],[341,5,341,6,1],[343,9,343,40,1],[344,9,344,22,1],[345,9,345,79,1],[348,9,348,52,1],[351,9,351,33,1],[352,9,352,99,1],[353,5,353,6,1],[359,5,359,6,1],[361,9,361,40,1],[362,9,362,23,1],[365,9,365,59,1],[365,59,365,82,1],[365,82,365,84,1],[366,5,366,6,1],[370,5,370,6,1],[372,9,372,56,1],[375,9,375,49,1],[378,9,378,33,1],[379,9,379,63,1],[380,5,380,6,1],[383,5,383,6,1],[384,9,400,11,1],[401,5,401,6,1]]);
    </script>
  </body>
</html>