GenerationId:
gen-1765203712-c7Ai6GIg1soQXJSRT5Bp

Content:
```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using NSubstitute;
using Xunit;

namespace Dataset.Sample5.UnitTests
{
    public class FolderServiceTests
    {
        private readonly IFolderRepository _folderRepository;
        private readonly FolderService _folderService;

        public FolderServiceTests()
        {
            _folderRepository = Substitute.For<IFolderRepository>();
            _folderService = new FolderService(_folderRepository);
        }

        [Fact]
        public async Task GetFolderAsync_PathIsNull_ReturnsRootFolder()
        {
            // Arrange
            var rootFolders = new List<FolderEntity>
            {
                new FolderEntity { Id = 1, Name = "Folder1", ParentId = null },
                new FolderEntity { Id = 2, Name = "Folder2", ParentId = null }
            };

            _folderRepository.GetRootFoldersAsync().Returns(rootFolders);

            // Act
            var result = await _folderService.GetFolderAsync(null);

            // Assert
            Assert.Equal(0, result.Id);
            Assert.Equal("Root", result.Name);
            Assert.Equal(rootFolders.Count, result.SubFolders.Count());
            Assert.Null(result.ParentId);
        }

        [Fact]
        public async Task GetFolderAsync_PathIsValid_ReturnsFolderWithSubfolders()
        {
            // Arrange
            var folderDto1 = new FolderEntity { Id = 1, Name = "Root", ParentId = null };
            var folderDto2 = new FolderEntity { Id = 2, Name = "Sub1", ParentId = 1 };
            var folderDto3 = new FolderEntity { Id = 3, Name = "Sub2", ParentId = 1 };

            var subfolders = new List<FolderEntity> { folderDto2, folderDto3 };

            _folderRepository.GetFolderByNameAsync(Arg.Any<string>(), Arg.Any<int?>()).Returns(folderDto1);
            _folderRepository.GetFolderByNameAsync("Sub1", 1).Returns(folderDto2);
            _folderRepository.GetFolderByNameAsync("Sub2", 1).Returns(folderDto3);

            // Act
            var result = await _folderService.GetFolderAsync("/Root/Sub1/Sub2");

            // Assert
            Assert.Equal(3, result.Id);
            Assert.Equal("Sub2", result.Name);
            Assert.Equal(1, result.ParentId);
        }

        [Fact]
        public async Task GetFolderAsync_PathDoesNotExist_ThrowsFolderNotFoundException()
        {
            // Arrange
            _folderRepository.GetFolderByNameAsync(Arg.Any<string>(), Arg.Any<int?>()).Returns((FolderEntity)null);

            // Act & Assert
            await Assert.ThrowsAsync<FolderNotFoundException>(() => _folderService.GetFolderAsync("/Invalid"));
        }

        [Fact]
        public async Task GetFolderAsync_FolderDoesNotExistInsidePath_ThrowsFolderNotFoundException()
        {
            // Arrange
            var folder1 = new FolderEntity { Id = 1, Name = "Root", ParentId = null };
            var folder2 = new FolderEntity { Id = 2, Name = "Sub1", ParentId = 1 };

            _folderRepository.GetFolderByNameAsync("Root", null).Returns(folder1);
            _folderRepository.GetFolderByNameAsync("Sub1", 1).Returns(folder2);
            _folderRepository.GetFolderByNameAsync("Sub2", 2).Returns((FolderEntity)null);

            // Act & Assert
            await Assert.ThrowsAsync<FolderNotFoundException>(() => _folderService.GetFolderAsync("/Root/Sub1/Sub2"));
        }

        [Fact]
        public async Task GetRootFoldersAsync_Invoked_ReturnsRootFolders()
        {
            // Arrange
            var folderEntities = new List<FolderEntity>
            {
                new FolderEntity { Id = 1, Name = "Folder1", ParentId = null },
                new FolderEntity { Id = 2, Name = "Folder2", ParentId = null }
            };

            _folderRepository.GetRootFoldersAsync().Returns(folderEntities);

            // Act
            var result = await _folderService.GetRootFoldersAsync();

            // Assert
            Assert.Equal(2, result.Count());
            Assert.Equal(folderEntities[0].Id, result.First().Id);
            Assert.Equal(folderEntities[1].Id, result.Last().Id);
        }

        [Fact]
        public async Task AddFolderAsync_ValidFolderDto_ReturnsAddedFolderId()
        {
            // Arrange
            var folderDto = new FolderDTO { Name = "NewFolder", ParentId = 1 };
            var folderEntity = new FolderEntity { Name = "NewFolder", ParentId = 1 };

            _folderRepository.GetFolderByNameAsync(Arg.Any<string>(), Arg.Any<int?>()).Returns((FolderEntity)null);
            _folderRepository.AddFolderAsync(Arg.Any<FolderEntity>()).Returns(100);

            // Act
            var result = await _folderService.AddFolderAsync(folderDto);

            // Assert
            Assert.Equal(100, result);
        }

        [Fact]
        public async Task AddFolderAsync_NullFolderDto_ThrowsArgumentNullException()
        {
            // Act & Assert
            await Assert.ThrowsAsync<ArgumentNullException>(() => _folderService.AddFolderAsync(null));
        }

        [Fact]
        public async Task AddFolderAsync_InvalidFolderName_ThrowsArgumentException()
        {
            // Arrange
            var folderDto = new FolderDTO { Name = "Invalid/Name", ParentId = 1 };

            // Act & Assert
            await Assert.ThrowsAsync<ArgumentException>(() => _folderService.AddFolderAsync(folderDto));
        }

        [Fact]
        public async Task AddFolderAsync_InvalidParentId_ThrowsArgumentException()
        {
            // Arrange
            var folderDto = new FolderDTO { Name = "ValidFolder", ParentId = 0 };

            // Act & Assert
            await Assert.ThrowsAsync<ArgumentException>(() => _folderService.AddFolderAsync(folderDto));
        }

        [Fact]
        public async Task AddFolderAsync_DuplicateFolderName_ThrowsArgumentException()
        {
            // Arrange
            var folderDto = new FolderDTO { Name = "ExistingFolder", ParentId = 1 };
            _folderRepository.GetFolderByNameAsync(Arg.Any<string>(), Arg.Any<int?>()).Returns(new FolderEntity());

            // Act & Assert
            await Assert.ThrowsAsync<ArgumentException>(() => _folderService.AddFolderAsync(folderDto));
        }
    }
}
```

ElapsedTimeMilliseconds:
9156,9649

OpenRouterElapsedTimeMilliseconds:
8961

PromptTokens:
1959

CompletionTokens:
1330

TotalTokens:
3289

TotalCost:
0,0005949